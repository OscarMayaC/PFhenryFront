{"ast":null,"code":"/**\n * @author Deepkolos / https://github.com/deepkolos\n */\nclass WorkerPool {\n  constructor() {\n    let pool = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 4;\n    this.pool = pool;\n    this.queue = [];\n    this.workers = [];\n    this.workersResolve = [];\n    this.workerStatus = 0;\n  }\n  _initWorker(workerId) {\n    if (!this.workers[workerId]) {\n      const worker = this.workerCreator();\n      worker.addEventListener('message', this._onMessage.bind(this, workerId));\n      this.workers[workerId] = worker;\n    }\n  }\n  _getIdleWorker() {\n    for (let i = 0; i < this.pool; i++) if (!(this.workerStatus & 1 << i)) return i;\n    return -1;\n  }\n  _onMessage(workerId, msg) {\n    const resolve = this.workersResolve[workerId];\n    resolve && resolve(msg);\n    if (this.queue.length) {\n      const {\n        resolve,\n        msg,\n        transfer\n      } = this.queue.shift();\n      this.workersResolve[workerId] = resolve;\n      this.workers[workerId].postMessage(msg, transfer);\n    } else {\n      this.workerStatus ^= 1 << workerId;\n    }\n  }\n  setWorkerCreator(workerCreator) {\n    this.workerCreator = workerCreator;\n  }\n  setWorkerLimit(pool) {\n    this.pool = pool;\n  }\n  postMessage(msg, transfer) {\n    return new Promise(resolve => {\n      const workerId = this._getIdleWorker();\n      if (workerId !== -1) {\n        this._initWorker(workerId);\n        this.workerStatus |= 1 << workerId;\n        this.workersResolve[workerId] = resolve;\n        this.workers[workerId].postMessage(msg, transfer);\n      } else {\n        this.queue.push({\n          resolve,\n          msg,\n          transfer\n        });\n      }\n    });\n  }\n  dispose() {\n    this.workers.forEach(worker => worker.terminate());\n    this.workersResolve.length = 0;\n    this.workers.length = 0;\n    this.queue.length = 0;\n    this.workerStatus = 0;\n  }\n}\nexport { WorkerPool };","map":{"version":3,"names":["WorkerPool","constructor","pool","arguments","length","undefined","queue","workers","workersResolve","workerStatus","_initWorker","workerId","worker","workerCreator","addEventListener","_onMessage","bind","_getIdleWorker","i","msg","resolve","transfer","shift","postMessage","setWorkerCreator","setWorkerLimit","Promise","push","dispose","forEach","terminate"],"sources":["/Users/rociopichardo/Desktop/PFhenryFront/node_modules/three-stdlib/utils/WorkerPool.js"],"sourcesContent":["/**\n * @author Deepkolos / https://github.com/deepkolos\n */\nclass WorkerPool {\n  constructor(pool = 4) {\n    this.pool = pool;\n    this.queue = [];\n    this.workers = [];\n    this.workersResolve = [];\n    this.workerStatus = 0;\n  }\n\n  _initWorker(workerId) {\n    if (!this.workers[workerId]) {\n      const worker = this.workerCreator();\n      worker.addEventListener('message', this._onMessage.bind(this, workerId));\n      this.workers[workerId] = worker;\n    }\n  }\n\n  _getIdleWorker() {\n    for (let i = 0; i < this.pool; i++) if (!(this.workerStatus & 1 << i)) return i;\n\n    return -1;\n  }\n\n  _onMessage(workerId, msg) {\n    const resolve = this.workersResolve[workerId];\n    resolve && resolve(msg);\n\n    if (this.queue.length) {\n      const {\n        resolve,\n        msg,\n        transfer\n      } = this.queue.shift();\n      this.workersResolve[workerId] = resolve;\n      this.workers[workerId].postMessage(msg, transfer);\n    } else {\n      this.workerStatus ^= 1 << workerId;\n    }\n  }\n\n  setWorkerCreator(workerCreator) {\n    this.workerCreator = workerCreator;\n  }\n\n  setWorkerLimit(pool) {\n    this.pool = pool;\n  }\n\n  postMessage(msg, transfer) {\n    return new Promise(resolve => {\n      const workerId = this._getIdleWorker();\n\n      if (workerId !== -1) {\n        this._initWorker(workerId);\n\n        this.workerStatus |= 1 << workerId;\n        this.workersResolve[workerId] = resolve;\n        this.workers[workerId].postMessage(msg, transfer);\n      } else {\n        this.queue.push({\n          resolve,\n          msg,\n          transfer\n        });\n      }\n    });\n  }\n\n  dispose() {\n    this.workers.forEach(worker => worker.terminate());\n    this.workersResolve.length = 0;\n    this.workers.length = 0;\n    this.queue.length = 0;\n    this.workerStatus = 0;\n  }\n\n}\n\nexport { WorkerPool };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}